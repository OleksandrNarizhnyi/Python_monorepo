### üîπ **MongoDB `$bucket` ‚Äî –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º**  

**`$bucket`** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ **–≥—Ä—É–ø–ø—ã (–∫–æ—Ä–∑–∏–Ω—ã) –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º –∑–Ω–∞—á–µ–Ω–∏–π**.  
–ö–∞–∂–¥–æ–π –≥—Ä—É–ø–ø–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è **–∫–ª—é—á** ‚Äî –≥—Ä–∞–Ω–∏—Ü—ã –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é.  

---

### ‚úÖ **–°–∏–Ω—Ç–∞–∫—Å–∏—Å**  
```js
{ 
  $bucket: {
    groupBy: "$<–ø–æ–ª–µ>",   // –ü–æ–ª–µ, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –≥—Ä—É–ø–ø–∏—Ä—É–µ–º
    boundaries: [0, 10, 20, 30], // –ì—Ä–∞–Ω–∏—Ü—ã –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ (–ª–µ–≤–∞—è –≤–∫–ª—é—á–µ–Ω–∞, –ø—Ä–∞–≤–∞—è –Ω–µ—Ç)
    default: "Other", // –ì—Ä—É–ø–ø–∞ –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
    output: { count: { $sum: 1 } } // (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  } 
}
```
üîπ –ö–∞–∂–¥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ **–ø–µ—Ä–≤—É—é –≥—Ä–∞–Ω–∏—Ü—É, –≥–¥–µ –æ–Ω–æ –º–µ–Ω—å—à–µ –≤–µ—Ä—Ö–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã**.  

---

### ‚úÖ **–ü—Ä–∏–º–µ—Ä: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ª—é–¥–µ–π –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–º**  
üìå **–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**  
```js
db.people.insertMany([
  { name: "Alice", age: 23 },
  { name: "Bob", age: 17 },
  { name: "Charlie", age: 35 },
  { name: "David", age: 41 },
  { name: "Eve", age: 12 }
])
```
üìå **–ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É (0-18, 18-30, 30-50)**  
```js
db.people.aggregate([
  { 
    $bucket: {
      groupBy: "$age",
      boundaries: [0, 18, 30, 50], 
      default: "50+",
      output: { count: { $sum: 1 } }
    }
  }
])
```
‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç**  
```js
{ "_id": 0, "count": 2 }   // (0-18): Bob (17), Eve (12)
{ "_id": 18, "count": 1 }  // (18-30): Alice (23)
{ "_id": 30, "count": 1 }  // (30-50): Charlie (35)
{ "_id": "50+", "count": 1 } // (50+): David (41)
```
üîπ **–ö–ª—é—á `_id`** ‚Äî —ç—Ç–æ –Ω–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞.  

---

### ‚úÖ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ (`output`)**  
–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ä–µ–¥–Ω–∏–π –≤–æ–∑—Ä–∞—Å—Ç:  
```js
db.people.aggregate([
  { 
    $bucket: {
      groupBy: "$age",
      boundaries: [0, 18, 30, 50],
      default: "50+",
      output: {
        count: { $sum: 1 },
        avgAge: { $avg: "$age" }
      }
    }
  }
])
```
‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç —Å `avgAge`**  
```js
{ "_id": 0, "count": 2, "avgAge": 14.5 }
{ "_id": 18, "count": 1, "avgAge": 23 }
{ "_id": 30, "count": 1, "avgAge": 35 }
{ "_id": "50+", "count": 1, "avgAge": 41 }
```



-----------------------------------------------------------------------------



### üîπ **MongoDB `$push` ‚Äî –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –≤ –º–∞—Å—Å–∏–≤**  

–û–ø–µ—Ä–∞—Ç–æ—Ä **`$push`** –ø–æ–∑–≤–æ–ª—è–µ—Ç **—Å–æ–±–∏—Ä–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –≤ –º–∞—Å—Å–∏–≤** –≤–Ω—É—Ç—Ä–∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏.

---

## ‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ `$group` (–ê–≥—Ä–µ–≥–∞—Ü–∏—è)**  

üìå **–ü—Ä–∏–º–µ—Ä: –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∑–∞–∫–∞–∑—ã –ø–æ –∫–ª–∏–µ–Ω—Ç—É –∏ —Å–æ–±–∏—Ä–∞–µ–º –∏—Ö –≤ –º–∞—Å—Å–∏–≤**  

**–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**  
```js
db.orders.insertMany([
  { _id: 1, customer: "Alice", product: "Laptop" },
  { _id: 2, customer: "Alice", product: "Mouse" },
  { _id: 3, customer: "Bob", product: "Keyboard" }
])
```
üìå **–ó–∞–ø—Ä–æ—Å: —Å–æ–±–∏—Ä–∞–µ–º `product` –≤ –º–∞—Å—Å–∏–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ `customer`**  
```js
db.orders.aggregate([
  { 
    $group: { 
      _id: "$customer", 
      products: { $push: "$product" } 
    }
  }
])
```
‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**  
```js
{ "_id": "Alice", "products": ["Laptop", "Mouse"] }
{ "_id": "Bob", "products": ["Keyboard"] }
```
üîπ **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç `$push`?**  
- –ë–µ—Ä—ë—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–æ–ª—è (`"$product"`)  
- –î–æ–±–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ –º–∞—Å—Å–∏–≤ `products`  



-----------------------------------------------------------------------------



### ‚úÖ **1. `$set`** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö

- **–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å**: –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ.
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**: 
  - –ï—Å–ª–∏ –ø–æ–ª–µ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –æ–Ω–æ **–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è** –∑–Ω–∞—á–µ–Ω–∏–µ–º, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã –∑–∞–¥–∞–µ—Ç–µ.
  - –ï—Å–ª–∏ –ø–æ–ª—è –Ω–µ—Ç, –æ–Ω–æ **–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è** –≤ –¥–æ–∫—É–º–µ–Ω—Ç.
  
### üìå **–ü—Ä–∏–º–µ—Ä**:
```js
db.collection.aggregate([
  {
    $set: {
      total: { $add: ["$price", "$tax"] },  // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ `total`
      status: "active"                     // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ `status`
    }
  }
])
```
‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –ø–æ–ª–µ `total`, –∞ —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `status` —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º "active".

---

### ‚úÖ **2. `$unset`** ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

- **–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å**: –£–¥–∞–ª–∏—Ç—å –æ–¥–Ω–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–µ–π –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞.
- **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**: –£–¥–∞–ª—è–µ—Ç **–ø–æ–ª–µ** –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞, –Ω–æ –Ω–µ –º–µ–Ω—è–µ—Ç —Å–∞–º—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **—Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–∞–ø–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏**, –∏ —Å–∞–º–æ –ø–æ–ª–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è.
  
### üìå **–ü—Ä–∏–º–µ—Ä**:
```js
db.collection.aggregate([
  {
    $unset: ["oldField1", "oldField2"]  // –£–¥–∞–ª—è–µ–º –ø–æ–ª—è `oldField1` –∏ `oldField2`
  }
])
```
‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç**:
- –ü–æ–ª—è `oldField1` –∏ `oldField2` –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏.



-----------------------------------------------------------------------------



### üîπ **MongoDB `$merge` ‚Äî –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –Ω–æ–≤—É—é –∏–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é**  

–û–ø–µ—Ä–∞—Ç–æ—Ä **`$merge`** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ **–∞–≥—Ä–µ–≥–∞—Ü–∏–∏** –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç:  
- **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é** –∏ –∑–∞–ø–∏—Å–∞—Ç—å –≤ –Ω–µ—ë —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–∞.  
- **–û–±–Ω–æ–≤–∏—Ç—å –∏–ª–∏ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ** –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏.  

---

## ‚úÖ **–°–∏–Ω—Ç–∞–∫—Å–∏—Å**  
```js
{ 
  $merge: { 
    into: "<—Ü–µ–ª–µ–≤–æ–π_–∫–æ–ª–ª–µ–∫—Ü–∏—è>", // –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏, –∫—É–¥–∞ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å
    on: "<–ø–æ–ª–µ>", // (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) –ö–ª—é—á –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π
    whenMatched: "<–¥–µ–π—Å—Ç–≤–∏–µ>", // (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –∫–ª—é—á–µ–π
    whenNotMatched: "<–¥–µ–π—Å—Ç–≤–∏–µ>" // (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç
  } 
}
```
---

## ‚úÖ **–ü—Ä–∏–º–µ—Ä 1: –ó–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –Ω–æ–≤—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é**  
üìå **–°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é `high_salary_employees` —Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞—Ä–ø–ª–∞—Ç–∞ –≤—ã—à–µ 5000**  
```js
db.employees.aggregate([
  { $match: { salary: { $gt: 5000 } } },
  { $merge: "high_salary_employees" }
])
```
üîπ –ï—Å–ª–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ **`high_salary_employees`** –Ω–µ –±—ã–ª–æ, **MongoDB —Å–æ–∑–¥–∞—Å—Ç –µ—ë** –∏ –∑–∞–ø–∏—à–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

---

## ‚úÖ **–ü—Ä–∏–º–µ—Ä 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏**  
üìå **–î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—è `employees_backup`, –∏ –º—ã —Ö–æ—Ç–∏–º –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ `employee_id`**  
```js
db.employees.aggregate([
  { $match: { salary: { $gt: 5000 } } },
  { 
    $merge: { 
      into: "employees_backup", 
      on: "employee_id", 
      whenMatched: "merge", 
      whenNotMatched: "insert" 
    }
  }
])
```
üîπ **–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç?**  
- –ï—Å–ª–∏ `employee_id` —É–∂–µ –µ—Å—Ç—å –≤ `employees_backup` ‚Üí **Mongo –æ–±–Ω–æ–≤–∏—Ç –¥–∞–Ω–Ω—ã–µ**.  
- –ï—Å–ª–∏ `employee_id` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Üí **Mongo –≤—Å—Ç–∞–≤–∏—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å**.  

---

## ‚úÖ **–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ–∂–∏–º—ã `whenMatched`**  
| –ó–Ω–∞—á–µ–Ω–∏–µ        | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------------|----------------|
| `"merge"` | **–û–±–Ω–æ–≤–ª—è–µ—Ç** —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é). |
| `"replace"` | **–ó–∞–º–µ–Ω—è–µ—Ç** –≤—Å—é –∑–∞–ø–∏—Å—å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏. |
| `"keepExisting"` | **–û—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ**, –Ω–æ–≤—ã–µ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è. |
| `"fail"` | –í—ã–¥–∞—ë—Ç –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. |
| `"pipeline"` | –ü–æ–∑–≤–æ–ª—è–µ—Ç **–∏–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º**|

üìå **–ü—Ä–∏–º–µ—Ä**  
```js
db.employees.aggregate([
  { $match: { salary: { $gt: 5000 } } },
  { 
    $merge: { 
      into: "employees_backup", 
      on: "employee_id", 
      whenMatched: [ { $set: { updated_at: new Date() } } ],
      whenNotMatched: "insert"
    }
  }
])
```
üîπ –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∫ –Ω–µ–π **–¥–æ–±–∞–≤–∏—Ç—Å—è –ø–æ–ª–µ `updated_at`**.


## ‚úÖ **–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ–∂–∏–º—ã `whenNotMatched`**  

| –ó–Ω–∞—á–µ–Ω–∏–µ         | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------------|----------------|
| `"insert"`      | **–î–æ–±–∞–≤–ª—è–µ—Ç** –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é). |
| `"discard"`     | **–ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç** –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, –Ω–µ –¥–æ–±–∞–≤–ª—è—è –∏—Ö. |
| `"fail"`        | **–í—ã–¥–∞—ë—Ç –æ—à–∏–±–∫—É**, –µ—Å–ª–∏ –∑–∞–ø–∏—Å–∏ –Ω–µ –±—ã–ª–æ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏. |

---

### **üìå –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏**  
- **`"insert"`** ‚Üí –ï—Å–ª–∏ `_id` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Ü–µ–ª–µ–≤–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏, –¥–æ–∫—É–º–µ–Ω—Ç **–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è**.  
- **`"discard"`** ‚Üí –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç, **–Ω–µ –≤—Å—Ç–∞–≤–ª—è—è –µ–≥–æ**.  
- **`"fail"`** ‚Üí –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—Å—Ç–∞–≤–∫–∏ –Ω–æ–≤–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞.  

---

## ‚úÖ **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `$merge`?**  
‚úî **–ß—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é.**  
‚úî **–ß—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –∏–ª–∏ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏.**  
‚úî **–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–æ–≤ –∏–ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –æ—Ç—á–µ—Ç–æ–≤.**  


-----------------------------------------------------------------------------




### üîπ **MongoDB `$map` ‚Äî –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∫ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É –º–∞—Å—Å–∏–≤–∞**  

–û–ø–µ—Ä–∞—Ç–æ—Ä **`$map`** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ **–∞–≥—Ä–µ–≥–∞—Ü–∏–∏** –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –≤–Ω—É—Ç—Ä–∏ –º–∞—Å—Å–∏–≤–∞.  
–ü–æ–∑–≤–æ–ª—è–µ—Ç **–æ–±–æ–π—Ç–∏ –º–∞—Å—Å–∏–≤**, –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞–¥ –∫–∞–∂–¥—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º –æ–ø–µ—Ä–∞—Ü–∏—é –∏ –≤–µ—Ä–Ω—É—Ç—å **–Ω–æ–≤—ã–π –º–∞—Å—Å–∏–≤**.  

---

## ‚úÖ **–°–∏–Ω—Ç–∞–∫—Å–∏—Å**  
```js
{
  $map: {
    input: "<–º–∞—Å—Å–∏–≤>",       // –ú–∞—Å—Å–∏–≤, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å
    as: "<–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è>",      // –ò–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞ –º–∞—Å—Å–∏–≤–∞
    in: "<–≤—ã—Ä–∞–∂–µ–Ω–∏–µ>"        // –û–ø–µ—Ä–∞—Ü–∏—è, –≤—ã–ø–æ–ª–Ω—è–µ–º–∞—è –Ω–∞–¥ –∫–∞–∂–¥—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º
  }
}
```
---

## ‚úÖ **–ü—Ä–∏–º–µ—Ä 1: –£–º–Ω–æ–∂–µ–Ω–∏–µ –≤—Å–µ—Ö —á–∏—Å–µ–ª –≤ –º–∞—Å—Å–∏–≤–µ –Ω–∞ 10**  
**–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**  
```js
db.students.insertOne({
  _id: 1,
  name: "Alice",
  scores: [5, 7, 9]
})
```
üìå **–ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å `$map`: —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤—Å–µ –æ—Ü–µ–Ω–∫–∏ –≤ `scores` –≤ 10 —Ä–∞–∑**  
```js
db.students.aggregate([
  {
    $project: {
      _id: 0,
      name: 1,
      new_scores: {
        $map: {
          input: "$scores",
          as: "score",
          in: { $multiply: ["$$score", 10] }
        }
      }
    }
  }
])
```
‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**  
```js
{ "name": "Alice", "new_scores": [50, 70, 90] }
```
üîπ **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `$map`?**  
- –ë–µ—Ä—ë—Ç –º–∞—Å—Å–∏–≤ `scores` (`input: "$scores"`)  
- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `as: "score"` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç **–∫–∞–∂–¥–æ–µ —á–∏—Å–ª–æ –∏–∑ –º–∞—Å—Å–∏–≤–∞**  
- –í—ã—Ä–∞–∂–µ–Ω–∏–µ `in: { $multiply: ["$$score", 10] }` —É–º–Ω–æ–∂–∞–µ—Ç —á–∏—Å–ª–æ –Ω–∞ 10  
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–Ω–æ–≤—ã–π –º–∞—Å—Å–∏–≤** `[50, 70, 90]`  

---

## ‚úÖ **–ü—Ä–∏–º–µ—Ä 2: –î–æ—Å—Ç—É–ø –∫ –ø–æ–ª—è–º –æ–±—ä–µ–∫—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏ –º–∞—Å—Å–∏–≤–∞**  
**–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**  
```js
db.students.insertOne({
  _id: 1,
  name: "Alice",
  subjects: [
    { name: "Math", score: 80 },
    { name: "Physics", score: 90 }
  ]
})
```
üìå **–î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ `passed`, –µ—Å–ª–∏ `score >= 85`**  
```js
db.students.aggregate([
  {
    $project: {
      _id: 0,
      name: 1,
      subjects: {
        $map: {
          input: "$subjects",
          as: "subject",
          in: {
            name: "$$subject.name",
            score: "$$subject.score",
            passed: { $gte: ["$$subject.score", 85] }
          }
        }
      }
    }
  }
])
```
‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**  
```js
{
  "name": "Alice",
  "subjects": [
    { "name": "Math", "score": 80, "passed": false },
    { "name": "Physics", "score": 90, "passed": true }
  ]
}
```
üîπ **–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ?**  
- –ú—ã –ø—Ä–æ—à–ª–∏—Å—å –ø–æ –º–∞—Å—Å–∏–≤—É `subjects`  
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∏–ª–∏, –±–æ–ª—å—à–µ –ª–∏ `score` **85**  
- –î–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤–æ–µ –ø–æ–ª–µ `"passed": true/false`  

---

## ‚úÖ **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `$map`?**  
‚úî **–ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –≤ –º–∞—Å—Å–∏–≤–µ**  
‚úî **–ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ –æ–±—ä–µ–∫—Ç—ã –º–∞—Å—Å–∏–≤–∞**  
‚úî **–ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –Ω–æ–≤—ã–π –º–∞—Å—Å–∏–≤ —Å –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏**  



-----------------------------------------------------------------------------



### üîπ **MongoDB `$$` ‚Äî –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –≤–Ω—É—Ç—Ä–∏ `$map`, `$filter` –∏ –¥—Ä.**  

–í **MongoDB –∞–≥—Ä–µ–≥–∞—Ü–∏—è—Ö** —Å–∏–º–≤–æ–ª `$$` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫:  
1Ô∏è‚É£ **–õ–æ–∫–∞–ª—å–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º** –≤–Ω—É—Ç—Ä–∏ `$map`, `$reduce`, `$filter`  
2Ô∏è‚É£ **–°–∏—Å—Ç–µ–º–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `$$ROOT`, `$$NOW`)  

---

## ‚úÖ **1. –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ª–æ–∫–∞–ª—å–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –≤ `$map`**  
üìå **–î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å –º–∞—Å—Å–∏–≤ —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ü–µ–Ω–∞–º–∏. –ù—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –∫–∞–∂–¥—É—é —Ü–µ–Ω—É –Ω–∞ 10%.**  

### **–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```js
db.products.insertOne({
  _id: 1,
  name: "Order1",
  items: [
    { name: "Laptop", price: 1000 },
    { name: "Phone", price: 500 }
  ]
})
```

üìå **–ò—Å–ø–æ–ª—å–∑—É–µ–º `$map`, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å `price` —É –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞:**  
```js
db.products.aggregate([
  {
    $project: {
      _id: 0,
      name: 1,
      updated_items: {
        $map: {
          input: "$items",
          as: "item",
          in: {
            name: "$$item.name",
            price: { $multiply: ["$$item.price", 1.1] } // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ü–µ–Ω—ã –Ω–∞ 10%
          }
        }
      }
    }
  }
])
```

‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**  
```js
{
  "name": "Order1",
  "updated_items": [
    { "name": "Laptop", "price": 1100 },
    { "name": "Phone", "price": 550 }
  ]
}
```

üîπ **–ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?**  
- `$map` **–ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –º–∞—Å—Å–∏–≤ `items`**  
- `as: "item"` —Å–æ–∑–¥–∞—ë—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `$$item`, –∫–æ—Ç–æ—Ä–∞—è —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ **–∫–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç –º–∞—Å—Å–∏–≤–∞**  
- `$$item.name` –∏ `$$item.price` **–æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –ø–æ–ª—è–º –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞**  

---

## ‚úÖ **2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `$$` –≤ `$filter`**  
üìå **–§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–≤–∞—Ä—ã –¥–æ—Ä–æ–∂–µ 600:**  
```js
db.products.aggregate([
  {
    $project: {
      _id: 0,
      name: 1,
      expensive_items: {
        $filter: {
          input: "$items",
          as: "item",
          cond: { $gt: ["$$item.price", 600] } // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã –¥–æ—Ä–æ–∂–µ 600
        }
      }
    }
  }
])
```
‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**  
```js
{
  "name": "Order1",
  "expensive_items": [
    { "name": "Laptop", "price": 1000 }
  ]
}
```
üîπ **–ó–¥–µ—Å—å `$$item.price` –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ `price` –≤–Ω—É—Ç—Ä–∏ `cond`**  



-----------------------------------------------------------------------------




### üîπ **MongoDB `$lookup` ‚Äî –î–∂–æ–∏–Ω (JOIN) –∫–æ–ª–ª–µ–∫—Ü–∏–π**  

–û–ø–µ—Ä–∞—Ç–æ—Ä **`$lookup`** –≤—ã–ø–æ–ª–Ω—è–µ—Ç **–∞–Ω–∞–ª–æ–≥ SQL JOIN** –≤ MongoDB, –æ–±—ä–µ–¥–∏–Ω—è—è –¥–æ–∫—É–º–µ–Ω—Ç—ã **–∏–∑ –¥–≤—É—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π** –ø–æ –æ–±—â–µ–º—É –ø–æ–ª—é.  

---

## ‚úÖ **–°–∏–Ω—Ç–∞–∫—Å–∏—Å**
```js
{
  $lookup: {
    from: "<–≤—Ç–æ—Ä–∞—è_–∫–æ–ª–ª–µ–∫—Ü–∏—è>",      // –ò–º—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –¥–ª—è JOIN
    localField: "<–ø–æ–ª–µ_–≤_—Ç–µ–∫—É—â–µ–π_–∫–æ–ª–ª–µ–∫—Ü–∏–∏>",  
    foreignField: "<–ø–æ–ª–µ_–≤–æ_–≤—Ç–æ—Ä–æ–π_–∫–æ–ª–ª–µ–∫—Ü–∏–∏>",  
    as: "<–∏–º—è_–º–∞—Å—Å–∏–≤–∞_–¥–ª—è_—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞>"  
  }
}
```
üîπ **–î–∞–Ω–Ω—ã–µ –∏–∑ `from` –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–∞–∫ –º–∞—Å—Å–∏–≤ –≤ `as`**  
üîπ **–ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ—Ç, –º–∞—Å—Å–∏–≤ –±—É–¥–µ—Ç –ø—É—Å—Ç—ã–º (`[]`)**  

---

## ‚úÖ **–ü—Ä–∏–º–µ—Ä 1: –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ `orders` –∏ `customers`**  

üìå **–ö–æ–ª–ª–µ–∫—Ü–∏—è `orders` (–∑–∞–∫–∞–∑—ã)**  
```js
db.orders.insertMany([
  { _id: 1, customer_id: 101, total: 50 },
  { _id: 2, customer_id: 102, total: 80 },
  { _id: 3, customer_id: 103, total: 100 }
])
```

üìå **–ö–æ–ª–ª–µ–∫—Ü–∏—è `customers` (–∫–ª–∏–µ–Ω—Ç—ã)**  
```js
db.customers.insertMany([
  { _id: 101, name: "Alice" },
  { _id: 102, name: "Bob" },
  { _id: 104, name: "Charlie" } // –ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤
])
```

üìå **–û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ `customer_id` ‚Üí `_id`**
```js
db.orders.aggregate([
  {
    $lookup: {
      from: "customers",
      localField: "customer_id",
      foreignField: "_id",
      as: "customer_info"
    }
  }
])
```

‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**  
```js
[
  {
    "_id": 1,
    "customer_id": 101,
    "total": 50,
    "customer_info": [{ "_id": 101, "name": "Alice" }]
  },
  {
    "_id": 2,
    "customer_id": 102,
    "total": 80,
    "customer_info": [{ "_id": 102, "name": "Bob" }]
  },
  {
    "_id": 3,
    "customer_id": 103,
    "total": 100,
    "customer_info": [] // –ö–ª–∏–µ–Ω—Ç–∞ —Å _id:103 –Ω–µ—Ç –≤ customers
  }
]
```
üîπ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**  
- `orders.customer_id` —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è —Å `customers._id`  
- –°–æ–≤–ø–∞–¥–µ–Ω–∏—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –º–∞—Å—Å–∏–≤ `customer_info`  
- –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ—Ç ‚Üí **–º–∞—Å—Å–∏–≤ –ø—É—Å—Ç–æ–π (`[]`)**  

---

## ‚úÖ **–ü—Ä–∏–º–µ—Ä 2: –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ `$unwind` –ø–æ—Å–ª–µ `$lookup`**  
üìå **–ï—Å–ª–∏ –Ω—É–∂–µ–Ω –æ–±—ä–µ–∫—Ç, –∞ –Ω–µ –º–∞—Å—Å–∏–≤**, –∏—Å–ø–æ–ª—å–∑—É–µ–º `$unwind`:  
```js
db.orders.aggregate([
  {
    $lookup: {
      from: "customers",
      localField: "customer_id",
      foreignField: "_id",
      as: "customer_info"
    }
  },
  { $unwind: "$customer_info" } // –ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –≤ –æ–±—ä–µ–∫—Ç
])
```
‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**  
```js
[
  { "_id": 1, "customer_id": 101, "total": 50, "customer_info": { "_id": 101, "name": "Alice" } },
  { "_id": 2, "customer_id": 102, "total": 80, "customer_info": { "_id": 102, "name": "Bob" } }
]
```
üîπ **–¢–µ–ø–µ—Ä—å `customer_info` ‚Äì –æ–±—ä–µ–∫—Ç, –∞ –Ω–µ –º–∞—Å—Å–∏–≤**  
üîπ –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –±—ã–ª–æ, –¥–æ–∫—É–º–µ–Ω—Ç **—É–¥–∞–ª–∏—Ç—Å—è**  

---

## ‚úÖ **–ü—Ä–∏–º–µ—Ä 3: –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π JOIN (–æ–±—Ä–∞—Ç–Ω—ã–π `$lookup`)**  
üìå **–ù–∞—Ö–æ–¥–∏–º –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –∏—Ö –∑–∞–∫–∞–∑—ã**  
```js
db.customers.aggregate([
  {
    $lookup: {
      from: "orders",
      localField: "_id",
      foreignField: "customer_id",
      as: "orders"
    }
  }
])
```
‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**  
```js
[
  {
    "_id": 101, "name": "Alice",
    "orders": [{ "_id": 1, "customer_id": 101, "total": 50 }]
  },
  {
    "_id": 102, "name": "Bob",
    "orders": [{ "_id": 2, "customer_id": 102, "total": 80 }]
  },
  {
    "_id": 104, "name": "Charlie",
    "orders": [] // –£ Charlie –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤
  }
]
```
üîπ –¢–µ–ø–µ—Ä—å –º–∞—Å—Å–∏–≤ **`orders`** —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∑–∞–∫–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–∞  




### üîπ **–û–ø–µ—Ä–∞—Ç–æ—Ä `$switch` –≤ MongoDB**
–û–ø–µ—Ä–∞—Ç–æ—Ä **`$switch`** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ **–º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π** (–∞–Ω–∞–ª–æ–≥ `switch-case` –≤ —è–∑—ã–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è).

### üìå **–°–∏–Ω—Ç–∞–∫—Å–∏—Å**
```js
{
  $switch: {
    branches: [
      { case: <—É—Å–ª–æ–≤–∏–µ1>, then: <–∑–Ω–∞—á–µ–Ω–∏–µ1> },
      { case: <—É—Å–ª–æ–≤–∏–µ2>, then: <–∑–Ω–∞—á–µ–Ω–∏–µ2> }
    ],
    default: <–∑–Ω–∞—á–µ–Ω–∏–µ_–ø–æ_—É–º–æ–ª—á–∞–Ω–∏—é>
  }
}
```

---
### ‚úÖ **–ü—Ä–∏–º–µ—Ä 1: –ü—Ä–∏—Å–≤–æ–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É**
–î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—è **`users`**:
```json
{ "_id": 1, "name": "Alice", "age": 5 }
{ "_id": 2, "name": "Bob", "age": 17 }
{ "_id": 3, "name": "Charlie", "age": 25 }
{ "_id": 4, "name": "David", "age": 65 }
```
–ú—ã —Ö–æ—Ç–∏–º –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ **`category`**:
- **"Child"** –¥–ª—è `age < 13`
- **"Teenager"** –¥–ª—è `13 <= age < 18`
- **"Adult"** –¥–ª—è `18 <= age < 60`
- **"Senior"** –¥–ª—è `age >= 60`

#### **–ó–∞–ø—Ä–æ—Å:**
```js
db.users.aggregate([
  {
    $project: {
      name: 1,
      age: 1,
      category: {
        $switch: {
          branches: [
            { case: { $lt: ["$age", 13] }, then: "Child" },
            { case: { $and: [{ $gte: ["$age", 13] }, { $lt: ["$age", 18] }] }, then: "Teenager" },
            { case: { $and: [{ $gte: ["$age", 18] }, { $lt: ["$age", 60] }] }, then: "Adult" }
          ],
          default: "Senior"
        }
      }
    }
  }
])
```

üîπ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
[
  { "_id": 1, "name": "Alice", "age": 5, "category": "Child" },
  { "_id": 2, "name": "Bob", "age": 17, "category": "Teenager" },
  { "_id": 3, "name": "Charlie", "age": 25, "category": "Adult" },
  { "_id": 4, "name": "David", "age": 65, "category": "Senior" }
]
```

---
### ‚úÖ **–ü—Ä–∏–º–µ—Ä 2: –í—ã–±–æ—Ä —Å–∫–∏–¥–∫–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É –∫–ª–∏–µ–Ω—Ç–∞**
–î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å –∑–∞–∫–∞–∑—ã, –∏ –º—ã —Ö–æ—Ç–∏–º –Ω–∞–∑–Ω–∞—á–∏—Ç—å —Å–∫–∏–¥–∫—É:
- **"VIP"** ‚Üí 20%
- **"Regular"** ‚Üí 10%
- **"New"** ‚Üí 5%

#### **–ó–∞–ø—Ä–æ—Å:**
```js
db.customers.aggregate([
  {
    $project: {
      name: 1,
      status: 1,
      discount: {
        $switch: {
          branches: [
            { case: { $eq: ["$status", "VIP"] }, then: 20 },
            { case: { $eq: ["$status", "Regular"] }, then: 10 }
          ],
          default: 5
        }
      }
    }
  }
])
```


